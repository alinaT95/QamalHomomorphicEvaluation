//
// Created by Alina Alinovna on 27.02.2021.
//

#ifndef UTILS_COMMONDATA_H
#define UTILS_COMMONDATA_H

#include <helib/helib.h>
#include <string>
#include <iostream>
#include <map>
#include <vector>

using namespace std;
using namespace helib;

typedef uint u32;
typedef unsigned char u8;
typedef vector<u8> pt_state; // [16]
typedef pt_state pt_roundkey;
typedef vector<Ctxt> CtxtByte;  // [8]
typedef vector<CtxtByte> CtxtState; // [16]
typedef map<string, Ctxt> CtxtMonomsOfSameDegree;
typedef vector<CtxtMonomsOfSameDegree> CtxtMonoms;

class CommonData {
    static CommonData *instance;

public:
    CommonData() {}
    static CommonData *getInstance() {
        if (!instance)
            instance = new CommonData;
        return instance;
    }

    static const map<int, vector<int>> splitting; //{ {2, {1, 1}},  {3, {2, 1}},  {4, {2, 2}}, {5, {3, 2}}, {6, {3, 3}}, {7, {4, 3}}};

    static const vector<string> S0Box;// = {"0", "01", "0123", "0123456", "0123457", "012346", "0123467", "012347", "01235", "012356", "012367", "01237", "0124", "0124567", "01246", "012467", "01256", "01257", "0127", "013", "01345", "013456", "01346", "01367", "014", "0145", "01456", "014567", "0147", "0157", "0167", "017", "02", "023", "02345", "023456", "023457", "023467", "02347", "023567", "0237", "0245", "0246", "0247", "025", "0256", "02567", "0257", "03", "0357", "036", "0367", "037", "045", "0456", "046", "05", "056", "06", "067", "1", "12", "1234", "12345", "123456", "1234567", "123457", "12346", "12347", "12356", "123567", "12357", "1236", "12367", "1237", "124567", "12457", "12467", "1247", "12567", "1257", "134", "1345", "134567", "13457", "13467", "135", "13567", "136", "1367", "14", "14567", "146", "147", "156", "1567", "157", "167", "234", "2345", "23456", "23457", "23467", "235", "2356", "2357", "24", "245", "2456", "246", "247", "25", "2567", "26", "27", "3", "34", "3456", "357", "36", "37", "4", "45", "46", "56"};
    static const vector<string> S1Box;// = {"0", "01234", "012345", "012346", "0123467", "0123567", "012357", "01245", "012467", "01247", "01256", "01257", "0126", "013", "0134", "013467", "01347", "01356", "01357", "0137", "0145", "01456", "014567", "01457", "01467", "0147", "0156", "01567", "0157", "023", "0234", "0234567", "023457", "02346", "023467", "02347", "0235", "02356", "02367", "0237", "024", "0256", "02567", "0267", "027", "03", "0345", "034567", "03457", "0346", "03467", "035", "0357", "036", "037", "04", "045", "0457", "0467", "056", "067", "12", "12345", "1234567", "12346", "123467", "12347", "1235", "12357", "1236", "12367", "1237", "124567", "1246", "12467", "1247", "12567", "1257", "126", "1267", "127", "13", "134567", "1346", "1347", "135", "1356", "1357", "1367", "145", "1457", "146", "147", "156", "1567", "17", "2", "2345", "23456", "234567", "23457", "2347", "23567", "2357", "2367", "24", "2467", "247", "25", "256", "2567", "257", "26", "27", "34", "3456", "3457", "3467", "35", "356", "36", "37", "45", "4567", "457", "46", "467", "56", "567", "57", "6", "67", "7"};
    static const vector<string> S2Box;// = {"0", "01", "0123", "0123457", "01235", "012356", "0123567", "012357", "012367", "012456", "0124567", "01247", "0125", "01256", "012567", "0126", "01267", "0127", "013", "0134", "01345", "0134567", "013457", "01346", "013467", "01347", "01356", "01367", "0145", "014567", "0146", "01467", "0147", "015", "0156", "01567", "0157", "016", "017", "0234567", "023467", "02347", "023567", "0245", "02456", "02457", "0246", "02467", "025", "0257", "027", "0345", "03456", "034567", "03467", "0356", "03567", "0357", "0367", "04567", "0457", "046", "0567", "067", "1", "1234", "123457", "12346", "123467", "12347", "1235", "12357", "1236", "12367", "124", "1246", "1257", "126", "127", "13", "13456", "13457", "1347", "13567", "1357", "1367", "14", "145", "14567", "1457", "1467", "147", "16", "2", "23", "234567", "2346", "2347", "23567", "236", "24", "245", "2456", "2457", "247", "25", "256", "2567", "257", "26", "267", "3", "34", "345", "34567", "3457", "3467", "347", "356", "3567", "357", "36", "367", "37", "4567", "457", "46", "47", "56", "567", "57", "67"};
    static const vector<string> S3Box;// = {"01234", "0123456", "0123457", "012346", "01235", "012356", "012357", "012367", "01237", "0124", "01245", "012457", "01246", "012567", "0126", "01267", "0134", "01345", "0134567", "013467", "01347", "0135", "013567", "01357", "0136", "0145", "01456", "0146", "01467", "0147", "0156", "01567", "016", "0167", "017", "02", "02345", "0234567", "02346", "023567", "02357", "0236", "024", "0245", "02456", "024567", "0246", "0247", "0256", "0267", "03", "0345", "03456", "03457", "0346", "036", "037", "04", "04567", "0457", "046", "05", "056", "057", "07", "1", "1234", "123456", "123467", "1235", "12356", "123567", "1236", "12367", "1237", "124", "1245", "12457", "1246", "1247", "1267", "134", "1345", "134567", "13457", "13467", "136", "1367", "1457", "15", "156", "1567", "16", "17", "23", "2346", "2347", "237", "24", "245", "2456", "24567", "2457", "246", "2467", "25", "2567", "257", "267", "345", "3456", "3457", "3467", "35", "356", "36", "367", "46", "47", "5", "56", "567", "57"};
    static const vector<string> S4Box;// = {"0123", "01234", "012345", "0123457", "012347", "01235", "012357", "012367", "0124567", "012457", "01246", "012467", "01256", "012567", "0126", "0127", "013", "0134", "013456", "0134567", "01346", "013467", "01356", "014567", "01457", "0146", "01467", "0147", "015", "017", "0234", "02345", "023467", "02347", "0235", "02357", "02367", "0237", "0245", "02456", "024567", "02457", "0247", "0256", "0257", "026", "027", "03", "0345", "03457", "0346", "03467", "035", "0356", "03567", "0357", "0367", "037", "045", "0457", "0467", "047", "057", "06", "067", "07", "1", "1234", "1234567", "12346", "123467", "123567", "12357", "1237", "12457", "12467", "1247", "125", "1257", "126", "13", "134", "1345", "134567", "13467", "135", "13567", "1456", "14567", "1457", "146", "1467", "15", "156", "1567", "16", "167", "17", "2", "23", "234", "234567", "2346", "2347", "235", "2356", "2357", "236", "2367", "237", "2457", "246", "2467", "247", "257", "3", "34", "345", "3457", "346", "3467", "347", "356", "3567", "357", "367", "37", "45", "456", "4567", "457", "47", "56", "57", "7"};
    static const vector<string> S5Box;// = {"012", "012345", "0123457", "01235", "012356", "012357", "01237", "0124", "01245", "0124567", "01246", "012467", "01247", "012567", "01257", "0126", "01345", "013456", "0134567", "01346", "013467", "01347", "01357", "0136", "014", "01456", "014567", "0156", "0157", "017", "02", "023", "023456", "0234567", "02346", "0235", "023567", "0236", "0237", "0245", "024567", "02457", "0246", "025", "0256", "026", "027", "03", "0345", "03456", "03467", "0347", "035", "0367", "037", "04", "045", "0457", "0467", "05", "056", "06", "1234", "12345", "123456", "1234567", "123467", "12356", "123567", "12367", "124", "12456", "124567", "12467", "1247", "125", "126", "1267", "127", "13", "134", "1345", "1346", "13467", "1356", "13567", "1357", "145", "1457", "146", "147", "157", "2", "23457", "2356", "23567", "24", "245", "2456", "247", "2567", "257", "267", "27", "3", "34567", "3457", "35", "356", "3567", "367", "4", "45", "47", "5", "56", "567", "67", "7"};
    static const vector<string> S6Box;//= {"01", "0123", "012345", "0123456", "012346", "0123467", "012347", "01235", "012357", "01236", "01245", "012457", "01246", "01256", "01257", "01267", "013", "01345", "0134567", "01357", "0136", "014", "01456", "0146", "0156", "016", "0167", "02", "0234", "02345", "023456", "0234567", "02346", "023467", "02347", "0235", "0236", "0237", "0245", "024567", "02457", "0246", "02467", "0247", "025", "026", "027", "03", "03456", "034567", "03467", "03567", "0357", "037", "04", "045", "0456", "04567", "046", "057", "07", "1", "12", "123", "123456", "1234567", "123457", "12346", "12347", "1235", "12356", "123567", "12357", "1236", "1237", "124", "1246", "12467", "125", "12567", "1257", "134", "13456", "134567", "1347", "136", "1456", "1457", "146", "1467", "147", "15", "1567", "157", "17", "23", "23456", "23457", "2346", "23467", "2347", "24", "245", "24567", "2457", "2467", "247", "2567", "257", "26", "27", "345", "34567", "3457", "35", "356", "3567", "367", "37", "4567", "457", "46", "47", "56", "567", "57", "67"};
    static const vector<string> S7Box;// = {"","012", "0123", "0123456", "0123457", "012346", "012347", "0123567", "012357", "01236", "01237", "01245", "012457", "012467", "01247", "012567", "0127", "013", "013457", "01346", "0135", "01356", "013567", "01357", "0146", "01467", "0147", "015", "0167", "017", "023", "0234", "0234567", "0235", "02356", "0236", "02456", "024567", "02457", "0246", "025", "0256", "027", "034", "03456", "034567", "0347", "0356", "03567", "0357", "037", "04", "0457", "0467", "056", "0567", "057", "067", "123", "1234", "1234567", "12346", "12356", "12357", "124567", "12457", "1256", "126", "1267", "127", "134", "13456", "13457", "1346", "1347", "135", "13567", "1357", "1367", "137", "14", "1456", "14567", "146", "147", "15", "156", "1567", "157", "167", "17", "234", "2345", "23456", "2347", "2357", "236", "2456", "24567", "246", "25", "256", "257", "26", "3", "34", "345", "3456", "3457", "3467", "35", "356", "3567", "36", "367", "4", "456", "4567", "47", "5", "56", "57", "67", "7"};
//+1
    static const vector<int> mu0;// = {30, 26, 25, 22, 19, 18, 14, 12, 11, 9, 8, 6, 4, 3, 2};
    static const vector<int> mu1;// = {31, 28, 25, 24, 23, 21, 19, 12, 10, 9, 8, 7, 6, 5, 3, 2, 1, 0};
    static const vector<int> mu2;//= {31, 29, 28, 25, 24, 23, 21, 20, 19, 18, 17, 16, 14, 13, 11, 9, 8, 7, 6, 4, 2, 1, 0};
    static const vector<int> mu3;//= {31, 30, 29, 25, 24, 21, 18, 17, 15, 14, 13, 12, 11, 10, 7, 6, 5, 4, 2, 1};
    static const vector<int> mu4;// = {31, 30, 27, 24, 22, 19, 16, 15, 11, 10, 9, 8, 7, 5, 3};
    static const vector<int> mu5;// = {31, 29, 28, 27, 25, 21, 19, 18, 14, 13, 12, 9, 7, 5, 3, 1, 0};
    static const vector<int> mu6;// = {29, 28, 25, 24, 22, 20, 19, 18, 15, 11, 9, 8, 7, 4};
    static const vector<int> mu7;// = {28, 25, 24, 22, 21, 20, 19, 17, 16, 13, 12, 9, 8, 7, 5, 3, 2};

    static const vector<vector<int>> Mu0PolySet;// = {mu0, mu1, mu2, mu3, mu4, mu5, mu6, mu7};

    static const vector<vector<string>> SBoxes;// = {S0Box, S1Box, S2Box, S3Box, S4Box, S5Box, S6Box, S7Box};

    static const vector<u8> SBoxesTable;

    static long eval_time(struct timeval start, struct timeval end);

    static void print_state(pt_state st);

    static void print_state_u8(u8 *st);

    static void printVec(long *vec, int dim);

};

#endif //UTILS_COMMONDATA_H
